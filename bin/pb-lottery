#!/usr/bin/env raku

use PB-Lottery;
use PB-Lottery::Subs;
use PB-Lottery::Classes;

# check for required env var
my $env-var = "PB_LOTTERY_PRIVATE_DIR";
my $pdir;
if %*ENV{$env-var}:exists {
    $pdir = %*ENV{$env-var};
}
else {
    print qq:to/HERE/;
    FATAL: Required env var '$env-var' not defined.
           Exiting...
    HERE
    exit(1);
}

say "DEBUG: early exit"; exit;

=begin comment
my $t = get-random-powerball-play;
say "random ticket: '$t'";
my $np = 4;
my @np = get-multiple-powerball-plays $np;
say "4 more plays:";
say "  '$_'" for @np;
say "DEBUG exit"; exit;
=end comment

# TODO:
#   put all draws and tickets here for easy visibility
#     + add a data file showing which ticket was used for which draw
#     + price of tickets
#     + accumulated cost
#   add a way to account for plus ups (exta cost for better odds or prizes)
#   use subs instead of methods for some things
#   ensure ticket id shows on output

# my current numbers: our @picks is export

# rules are complicated
my $rules = q:to/HERE/;
# winning matches and prizes:
#   1 numbers + pb or just pb      $4
#   2 numbers + pb or 3 numbers    $7
#   3 numbers + pb or 4 numbers    $100
#   4 numbers + pb                 $50,000
#   5 numbers                      $1,000,000
#   5 numbers + pb                 current jackpot
HERE

# Note the first five number must be in the range 1..69
# The last number is the Power Ball in the range 1..26
# the official Power Ball draws by date:
my $lnum = "x x x x x x 2025-08-27";
my @draws = [
   # a  b  c  d  e  f # <= %nums hash key
    "09 12 22 41 61 25 2025-08-27 pb",
    "03 18 22 27 33 17 2025-08-30 pb",

    # with this draw we started playing double play with
    #   1 Sep 2025 tickets at $4 a pop so we have to 
    #   start checking our tickets for 2 draws
    "08 23 25 40 53 05 2025-09-01 pb", # <= the Power Ball draw
    "10 15 26 48 67 19 2025-09-01 dp", # <= the Double Play draw

    # next draw
    "03 16 29 61 69 22 2025-09-03 pb",
    "07 32 39 50 61 04 2025-09-03 dp",

    # next draw 
    "26 28 41 53 64 09 2025-09-08 pb",
    "07 18 19 22 68 13 2025-09-08 db",

    # next draw	
];

our @picks is export = [
    # my Florida Lottery numbers (last number is Power Ball)
    # first 5 numbers are Florida Lottery, last number is the Power ball
    # a  b  c  d  e  f # <= %nums hash key
    #                  valid date
    #                  for pick   |<= Power Play
    #                                |<= Double Play
    #                                   |<= Quick pick (for history)
    "18 30 37 45 56 18 2025-09-22 pp dp qp",
];

my @alpha = 'A'..'Z';

if not @*ARGS {
    say qq:to/HERE/;
    Enter the lottery winning numbers and dates in this file at the top.
    HERE
    exit;
}

my $show-rules = True;
print $rules;
for @draws.kv -> $i is copy, $entry {
    # each wnum is a draw on that date
    my $w = LNum.new: :$entry;
#   say $w.date;
#   $w.show: $i;

    # for that draw result, compare each of our number sets for any matches
    my $show-draw = True;
    for @picks -> $pnum {
        my $p = LNum.new: :entry($pnum);
        if $show-draw {
            $p.matches: $w, :$show-draw;
            $show-draw = False;
        }
        else {
            $p.matches: $w; #, :$show-draw;
        }
    }
}
